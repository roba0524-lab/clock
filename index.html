<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç½®æ™‚è¨ˆï¼‹å¤©æ°—</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root {
  --bg: rgb(51,123,204);
  --text: #ffffff;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family:
    -apple-system,
    BlinkMacSystemFont,
    "SF Pro Display",
    "Hiragino Kaku Gothic ProN",
    "Noto Sans JP",
    sans-serif;

  height: calc(var(--vh, 1vh) * 100);
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* ğŸ”¥ ç„¼ãä»˜ãé˜²æ­¢ */
.container {
  width: 100%;
  text-align: center;
  animation: burninShift 180s infinite alternate ease-in-out;
}

@keyframes burninShift {
  from { transform: translate(0, 0); }
  to   { transform: translate(12px, 8px); }
}

/* =====================
   â° æ™‚ãƒ»åˆ†ï¼ˆApple Watché¢¨ï¼‰
===================== */
.time-block {
  line-height: 0.9;
}

.hour {
  font-size: 34vw;
  font-weight: 900;
  letter-spacing: -0.06em;
}

.minute {
  font-size: 30vw;
  font-weight: 900;
  letter-spacing: -0.06em;
}

/* ğŸ“… æ—¥ä»˜ï¼ˆ1.5å€ï¼‰ */
.date {
  margin-top: 2vh;
  font-size: 6vw;
  opacity: 0.9;
}

/* =====================
   ğŸŒ¤ å¤©æ°—ï¼ˆå…¨éƒ¨2å€ï¼‰
===================== */
.weather {
  margin-top: 3vh;
}

.weather-icon {
  font-size: 10vw;
  margin-bottom: 1vh;
}

.weather-temp {
  font-size: 7vw;
  font-weight: 600;
  line-height: 1.3;
}

.weather-rain {
  margin-top: 1vh;
  font-size: 7vw;
  font-weight: 600;
}
</style>
</head>

<body>
<div class="container">

  <div class="time-block">
    <div class="hour" id="hour">--</div>
    <div class="minute" id="minute">--</div>
  </div>

  <div class="date" id="date">----</div>

  <div class="weather">
    <div class="weather-icon" id="weatherIcon">--</div>

    <div class="weather-temp" id="tempMax">æœ€é«˜ --â„ƒ</div>
    <div class="weather-temp" id="tempMin">æœ€ä½ --â„ƒ</div>
    <div class="weather-temp" id="tempNow">ç¾åœ¨ --â„ƒ</div>

    <div class="weather-rain" id="rain">â˜‚ï¸ æœªå–å¾—</div>
  </div>

</div>

<script>
/* ğŸ“ Safarié«˜ã•å¯¾ç­– */
function fixHeight() {
  document.documentElement.style.setProperty(
    "--vh",
    window.innerHeight * 0.01 + "px"
  );
}
fixHeight();
window.addEventListener("resize", fixHeight);

/* â° æ™‚è¨ˆ */
function updateTime() {
  const now = new Date();

  hour.textContent = now.getHours().toString().padStart(2, "0");
  minute.textContent = now.getMinutes().toString().padStart(2, "0");

  date.textContent = now.toLocaleDateString("ja-JP", {
    month: "long",
    day: "numeric",
    weekday: "short"
  });

  updateBackground(now);
}
setInterval(updateTime, 1000);
updateTime();

/* ğŸŒ¤ å¤©æ°— */
async function fetchWeather() {
  try {
    const url =
      "https://api.open-meteo.com/v1/forecast" +
      "?latitude=34.612&longitude=135.734" +
      "&current=temperature_2m" +
      "&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,weather_code" +
      "&timezone=Asia%2FTokyo";

    const res = await fetch(url);
    const data = await res.json();

    const max = Math.round(data.daily.temperature_2m_max[0]);
    const min = Math.round(data.daily.temperature_2m_min[0]);
    const nowTemp = Math.round(data.current.temperature_2m);
    const rain = data.daily.precipitation_probability_max[0];
    const code = data.daily.weather_code[0];

    let icon = "â˜€ï¸";
    if (code >= 1 && code <= 3) icon = "â›…";
    else if (code >= 45 && code <= 48) icon = "â˜ï¸";
    else if (code >= 51) icon = "ğŸŒ§ï¸";

    weatherIcon.textContent = icon;
    tempMax.textContent = `æœ€é«˜ ${max}â„ƒ`;
    tempMin.textContent = `æœ€ä½ ${min}â„ƒ`;
    tempNow.textContent = `ç¾åœ¨ ${nowTemp}â„ƒ`;
    rain.textContent = rain != null ? `â˜‚ï¸ ${rain}%` : "â˜‚ï¸ æœªå–å¾—";

    updateBackground(new Date(), rain, code);

  } catch {
    weatherIcon.textContent = "--";
    rain.textContent = "â˜‚ï¸ æœªå–å¾—";
  }
}

fetchWeather();
setInterval(fetchWeather, 30 * 60 * 1000);

/* ğŸ¨ èƒŒæ™¯åˆ¶å¾¡ */
function updateBackground(now, rain = 0, code = 0) {
  const hour = now.getHours();

  if (hour >= 18) {
    document.documentElement.style.setProperty("--bg", "#0b1d3a");
    return;
  }

  if (rain >= 50) {
    document.documentElement.style.setProperty("--bg", "#666666");
    return;
  }

  if (code === 0) {
    document.documentElement.style.setProperty("--bg", "#ff9800");
  } else {
    document.documentElement.style.setProperty("--bg", "rgb(51,123,204)");
  }
}
</script>
</body>
</html>
