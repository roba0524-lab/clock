<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç½®æ™‚è¨ˆï¼‹å¤©æ°—</title>

<!-- ğŸ“± iPhone å…¨ç”»é¢åŒ–å¯¾ç­– -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root {
  --bg: rgb(51,123,204);
  --text: #ffffff;
}

/* =====================
   ğŸ“ Safarié«˜ã•å¯¾ç­–
===================== */
body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family:
    "Hiragino Kaku Gothic ProN",
    "Noto Sans JP",
    -apple-system,
    BlinkMacSystemFont,
    "Segoe UI",
    sans-serif;

  height: calc(var(--vh, 1vh) * 100);
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* ğŸ”¥ ç„¼ãä»˜ãé˜²æ­¢ */
.container {
  width: 100%;
  text-align: center;
  animation: burninShift 180s infinite alternate ease-in-out;
}

@keyframes burninShift {
  from { transform: translate(0, 0); }
  to   { transform: translate(12px, 8px); }
}

/* â° æ™‚è¨ˆ */
.time {
  font-size: 28vw;
  font-weight: 900;
  line-height: 1;
  letter-spacing: -0.04em;
}

/* ğŸ“… æ—¥ä»˜ */
.date {
  font-size: 4vw;
  margin-top: 1vh;
  opacity: 0.9;
}

/* ğŸŒ¤ å¤©æ°— */
.weather {
  margin-top: 4vh;
}

.weather-line1 {
  font-size: 5vw;
  font-weight: 600;
}

.weather-line2 {
  font-size: 4.5vw;
  margin-top: 1vh;
}
</style>
</head>

<body>
<div class="container">
  <div class="time" id="time">--:--</div>
  <div class="date" id="date">----</div>

  <div class="weather">
    <div class="weather-line1" id="weatherLine1">
      -- / --â„ƒï¼ˆ--â„ƒï¼‰
    </div>
    <div class="weather-line2" id="weatherLine2">
      â˜‚ï¸ æœªå–å¾—
    </div>
  </div>
</div>

<script>
/* =====================
   ğŸ“ Safarié«˜ã•å›ºå®š
===================== */
function fixHeight() {
  document.documentElement.style.setProperty(
    "--vh",
    window.innerHeight * 0.01 + "px"
  );
}
fixHeight();
window.addEventListener("resize", fixHeight);

/* =====================
   â° æ™‚è¨ˆ
===================== */
function updateTime() {
  const now = new Date();

  time.textContent =
    now.getHours().toString().padStart(2, "0") + ":" +
    now.getMinutes().toString().padStart(2, "0");

  date.textContent = now.toLocaleDateString("ja-JP", {
    month: "long",
    day: "numeric",
    weekday: "short"
  });

  updateBackground(now);
}
setInterval(updateTime, 1000);
updateTime();

/* =====================
   ğŸŒ¤ å¤©æ°—å–å¾—
===================== */
async function fetchWeather() {
  try {
    const url =
      "https://api.open-meteo.com/v1/forecast" +
      "?latitude=34.612&longitude=135.734" +
      "&current=temperature_2m" +
      "&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,weather_code" +
      "&timezone=Asia%2FTokyo";

    const res = await fetch(url);
    const data = await res.json();

    const max = Math.round(data.daily.temperature_2m_max[0]);
    const min = Math.round(data.daily.temperature_2m_min[0]);
    const nowTemp = Math.round(data.current.temperature_2m);
    const rain = data.daily.precipitation_probability_max[0];
    const code = data.daily.weather_code[0];

    let icon = "â˜€ï¸";
    if (code >= 1 && code <= 3) icon = "â›…";
    else if (code >= 45 && code <= 48) icon = "â˜ï¸";
    else if (code >= 51) icon = "ğŸŒ§ï¸";

    weatherLine1.textContent =
      `${icon} ${max}â„ƒ / ${min}â„ƒï¼ˆ${nowTemp}â„ƒï¼‰`;

    weatherLine2.textContent =
      rain != null ? `â˜‚ï¸ ${rain}%` : "â˜‚ï¸ æœªå–å¾—";

    updateBackground(new Date(), rain, code);

  } catch {
    weatherLine1.textContent = "-- / --â„ƒï¼ˆ--â„ƒï¼‰";
    weatherLine2.textContent = "â˜‚ï¸ æœªå–å¾—";
  }
}

fetchWeather();
setInterval(fetchWeather, 30 * 60 * 1000);

/* =====================
   ğŸ¨ èƒŒæ™¯è‰²åˆ¶å¾¡
===================== */
function updateBackground(now, rain = 0, code = 0) {
  const hour = now.getHours();

  if (hour >= 18) {
    document.documentElement.style.setProperty("--bg", "#0b1d3a");
    return;
  }

  if (rain >= 50) {
    document.documentElement.style.setProperty("--bg", "#666666");
    return;
  }

  if (code === 0) {
    document.documentElement.style.setProperty("--bg", "#ff9800");
  } else {
    document.documentElement.style.setProperty("--bg", "rgb(51,123,204)");
  }
}
</script>
</body>
</html>
